<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout | TradeShip</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<section class="products">
    <div class="product-detail">
        <h2>Checkout</h2>

        <div id="cartItems"></div>
        <h3 id="totalPrice"></h3>

        <h3>Delivery Information</h3>
        <input type="text" id="fullName" placeholder="Full Name"><br><br>
        <input type="text" id="address" placeholder="Complete Address"><br><br>
        <input type="text" id="contact" placeholder="Contact Number"><br><br>

        <h3>Claiming Method</h3>
        <select id="claimMethod">
            <option>Delivery</option>
            <option>Pickup</option>
        </select>

        <br><br>
        <button class="primary-btn" onclick="placeOrder()">Place Order</button>
        <a href="cart.html" class="primary-btn">⬅ Back to Cart</a>
    </div>
</section>

<script>
const currentUser = localStorage.getItem("currentUser");
if (!currentUser) {
    alert("Please login first.");
    window.location.href = "login.html";
}

function getCart() {
    const user = localStorage.getItem("currentUser");
    if (!user) return [];
    const carts = JSON.parse(localStorage.getItem("userCarts")) || {};
    return carts[user] || [];
}

function saveCart(cart) {
    const user = localStorage.getItem("currentUser");
    if (!user) return;
    const carts = JSON.parse(localStorage.getItem("userCarts")) || {};
    carts[user] = cart;
    localStorage.setItem("userCarts", JSON.stringify(carts));
}


function clearCart() {
    const allCarts = JSON.parse(localStorage.getItem("userCarts")) || {};
    allCarts[currentUser] = [];
    localStorage.setItem("userCarts", JSON.stringify(allCarts));
}

function showCart() {
    const cart = getCart();
    const cartDiv = document.getElementById("cartItems");
    cartDiv.innerHTML = "";

    if (cart.length === 0) {
        cartDiv.innerHTML = "<p>Your cart is empty.</p>";
        document.getElementById("totalPrice").innerText = "";
        return;
    }

    let total = 0;
    cart.forEach(item => {
        total += Number(item.price);
        const itemDiv = document.createElement("p");
        itemDiv.innerText = `${item.name} - ₱${item.price}`;
        cartDiv.appendChild(itemDiv);
    });

    document.getElementById("totalPrice").innerText = "Total: ₱" + total;
}

function placeOrder() {
    const fullName = document.getElementById("fullName").value.trim();
    const address = document.getElementById("address").value.trim();
    const contact = document.getElementById("contact").value.trim();
    const claimMethod = document.getElementById("claimMethod").value;

    if (!fullName || !address || !contact) {
        alert("Please fill in all delivery information.");
        return;
    }

    alert(`Thank you ${fullName}! Your order has been placed.\nClaiming Method: ${claimMethod}`);
    clearCart();
    window.location.href = "index.html";
}

showCart();
</script>

</body>
</html>